@if (isOpen()) {
  <div class="dropdown" role="listbox" aria-label="Search results">
    @if (isLoading() && results().length === 0) {
      <!-- Loading skeleton -->
      <div class="loading-container" role="status" aria-live="polite">
        @for (i of [1, 2, 3, 4]; track i) {
          <div class="result-item skeleton">
            <div class="avatar-skeleton"></div>
            <div class="text-skeleton">
              <div class="username-skeleton"></div>
              <div class="fullname-skeleton"></div>
            </div>
          </div>
        }
      </div>
    } @else if (error()) {
      <!-- Error state -->
      <div class="error-state" role="alert">
        <span class="error-message">{{ error() }}</span>
      </div>
    } @else if (results().length === 0) {
      <!-- Empty state -->
      <div class="empty-state" role="status">
        No users found
      </div>
    } @else {
      <!-- Results list -->
      @for (user of results(); track trackByUsername($index, user); let idx = $index) {
        <div 
          class="result-item" 
          [class.active]="isActive(idx)"
          role="option"
          [attr.aria-selected]="isActive(idx)"
          [attr.data-username]="user.username"
          [attr.data-index]="idx"
          tabindex="0"
          (click)="onSelect(user.username)"
          (keydown.enter)="onSelect(user.username); $event.preventDefault()"
          (keydown.space)="onSelect(user.username); $event.preventDefault()">
          
          <!-- Avatar placeholder (circular) -->
          <div class="avatar-placeholder" [attr.aria-hidden]="true">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="20" cy="20" r="20" fill="#DBDBDB"/>
              <circle cx="20" cy="16" r="7" fill="#FFFFFF"/>
              <path d="M8 32C8 26 12 22 20 22C28 22 32 26 32 32" fill="#FFFFFF"/>
            </svg>
          </div>
          
          <!-- User info -->
          <div class="user-details">
            <div class="username-row">
              <span class="username">{{ user.username }}</span>
              @if (user.isVerified) {
                <span class="verified-badge" aria-label="Verified" title="Verified">âœ“</span>
              }
            </div>
            @if (user.fullName) {
              <div class="full-name">{{ user.fullName }}</div>
            }
          </div>
        </div>
      }
      @if (isLoading()) {
        <div class="loading-more" role="status" aria-live="polite">Refreshing...</div>
      }
    }
  </div>
}
