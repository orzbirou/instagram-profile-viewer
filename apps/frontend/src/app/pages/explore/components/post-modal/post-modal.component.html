<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <button class="close-btn" (click)="close.emit()" aria-label="Close">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18M6 6l12 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <div class="modal-content">
      <!-- Left: Media viewer -->
      <div class="media-section">
        <div class="media-container">
          @if (getVideoUrl()) {
            <video
              class="media-video"
              [src]="getVideoUrl()"
              controls
              autoplay
              loop>
              Your browser does not support the video tag.
            </video>
          } @else {
            <img
              class="media-image"
              [src]="getMediaUrl()"
              [alt]="'Post by ' + item().user.username"
            />
          }

          <!-- Carousel navigation -->
          @if (hasCarousel()) {
            @if (canGoPrev()) {
              <button class="carousel-btn prev-btn" (click)="prevCarouselItem()" aria-label="Previous">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 12L6 8l4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            }
            @if (canGoNext()) {
              <button class="carousel-btn next-btn" (click)="nextCarouselItem()" aria-label="Next">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="white" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 12l4-4-4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            }
            
            <!-- Carousel dots -->
            <div class="carousel-dots">
              @for (media of item().carousel_media; track $index) {
                <div 
                  class="dot"
                  [class.active]="$index === currentCarouselIndex()">
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Right: Post details -->
      <div class="details-section">
        <!-- User info -->
        <div class="user-header">
          <img
            class="user-avatar"
            [src]="item().user.profile_pic_url"
            [alt]="item().user.username"
            width="32"
            height="32"
          />
          <div class="user-info">
            <div class="username-row">
              <span class="username">{{ item().user.username }}</span>
              @if (item().user.is_verified) {
                <svg class="verified-badge" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="7" cy="7" r="7" fill="#0095F6"/>
                  <path d="M10.5 5L6 9.5L3.5 7" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              }
            </div>
            @if (item().user.full_name) {
              <div class="full-name">{{ item().user.full_name }}</div>
            }
          </div>
        </div>

        <!-- Caption (if available) -->
        @if (getCaption()) {
          <div class="caption-section">
            <span class="caption-username">{{ item().user.username }}</span>
            <span class="caption-text">{{ getCaption() }}</span>
          </div>
        }

        <!-- Stats and timestamp -->
        <div class="stats-section">
          <div class="stats-row">
            <div class="stat-item">
              <svg class="stat-icon" width="20" height="20" viewBox="0 0 20 20" fill="#262626" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 17.5L8.875 16.5C4.5 12.6 1.5 9.95 1.5 6.75C1.5 4.1 3.6 2 6.25 2C7.75 2 9.2 2.7 10 3.825C10.8 2.7 12.25 2 13.75 2C16.4 2 18.5 4.1 18.5 6.75C18.5 9.95 15.5 12.6 11.125 16.5L10 17.5Z"/>
              </svg>
              <span class="stat-count">{{ formatCount(item().like_count) }} likes</span>
            </div>
            <div class="stat-item">
              <svg class="stat-icon" width="20" height="20" viewBox="0 0 20 20" fill="#262626" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 10C18 14.4183 14.4183 18 10 18C8.9 18 7.85 17.8 6.9 17.4L2 18L3.1 14.1C2.4 12.9 2 11.5 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10Z"/>
              </svg>
              <span class="stat-count">{{ formatCount(item().comment_count) }} comments</span>
            </div>
          </div>
          <div class="timestamp">{{ formatDate(item().taken_at) }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
