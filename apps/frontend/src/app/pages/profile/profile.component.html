@if (loading()) {
  <div class="loading">
    Loading profile...
  </div>
} @else if (error()) {
  <div class="error">
    {{ error() }}
  </div>
} @else if (profile()) {
  <div class="profile-container">
    <app-profile-header [profile]="profile()!" />
    
    <!-- Highlights section -->
    <app-profile-highlights
      [highlights]="highlights()"
      [isLoading]="highlightsLoading()"
      [error]="highlightsError()"
      (retry)="retryHighlights()"
    />
    
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="selectedTab() === 'posts'"
        (click)="setTab('posts')"
        type="button"
        aria-label="Posts">
        <svg class="tab-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
        </svg>
        <span class="tab-label">Posts</span>
      </button>
      
      <button 
        class="tab" 
        [class.active]="selectedTab() === 'reels'"
        (click)="setTab('reels')"
        type="button"
        aria-label="Reels">
        <svg class="tab-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.5 5.5A1.5 1.5 0 014 4h16a1.5 1.5 0 011.5 1.5v13a1.5 1.5 0 01-1.5 1.5H4a1.5 1.5 0 01-1.5-1.5v-13zm2 0v13H20v-13H4.5z"/>
          <path d="M9.5 8.5l6 4-6 4v-8z"/>
        </svg>
        <span class="tab-label">Reels</span>
      </button>
      
      <button 
        class="tab" 
        [class.active]="selectedTab() === 'tagged'"
        (click)="setTab('tagged')"
        type="button"
        aria-label="Tagged">
        <svg class="tab-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.5 8.5a2 2 0 114 0 2 2 0 01-4 0z"/>
          <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v16a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 1v14h14V5H5z"/>
          <path d="M12.5 13.5a3 3 0 00-3 3v2h6v-2a3 3 0 00-3-3z"/>
        </svg>
        <span class="tab-label">Tagged</span>
      </button>
      
      <button 
        class="tab" 
        [class.active]="selectedTab() === 'reposts'"
        (click)="setTab('reposts')"
        type="button"
        aria-label="Reposts">
        <svg class="tab-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7h-2z"/>
        </svg>
        <span class="tab-label">Reposts</span>
      </button>
    </div>
    
    <!-- Posts content based on selectedTab -->
    @if (selectedTab() === 'posts') {
      @if (tabError()) {
        <div class="error-state" style="padding: 40px 20px; text-align: center;">
          <p style="color: #ed4956; margin: 0 0 16px 0;">{{ tabError() }}</p>
          <button 
            style="padding: 8px 16px; background: #0095f6; color: white; border: none; border-radius: 4px; cursor: pointer;"
            (click)="loadPosts({ reset: true })">
            Retry
          </button>
        </div>
      } @else if (isLoading() && items().length === 0) {
        <div class="loading-state" style="padding: 40px 20px; text-align: center; color: #8e8e8e;">
          Loading posts...
        </div>
      } @else if (items().length > 0) {
        <div class="posts-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 28px; margin-top: 20px;">
          @for (item of items(); track item.code) {
            <div class="post-item" style="position: relative; aspect-ratio: 1; background: #fafafa;">
              <img 
                [src]="item.displayUrl" 
                [alt]="'Post ' + item.code"
                style="width: 100%; height: 100%; object-fit: cover;">
            </div>
          }
        </div>
        
        @if (moreAvailable() && !isLoading()) {
          <div style="text-align: center; margin: 32px 0;">
            <button 
              style="padding: 12px 24px; background: #0095f6; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;"
              (click)="loadMore()">
              Load More
            </button>
          </div>
        }
        
        @if (isLoading() && items().length > 0) {
          <div style="text-align: center; margin: 32px 0; color: #8e8e8e; font-size: 14px;">
            Loading more...
          </div>
        }
      } @else {
        <div class="empty-state" style="padding: 40px 20px; text-align: center; color: #8e8e8e;">
          No posts yet
        </div>
      }
    } @else {
      <!-- Legacy grid for other tabs (reels, tagged, reposts) -->
      <app-profile-posts-grid
        [posts]="activeGridItems()"
        [isLoading]="activeGridLoading()"
      />
    }
  </div>
}
